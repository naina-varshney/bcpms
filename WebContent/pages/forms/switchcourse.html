<!DOCTYPE html>
<html style="height: auto;"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>BCPMS| ShiftStudent</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
  
  <!-- Theme style -->
  <link rel="stylesheet" href="../../dist/css/adminlte.min.css">
  <style>
      body:not(.sidebar-mini-md) .content-wrapper, body:not(.sidebar-mini-md) .main-footer, body:not(.sidebar-mini-md) .main-header {
    transition: margin-left .3s ease-in-out;
    margin-left: 0px;
}
  </style>
</head>
<body class="hold-transition sidebar-mini">
    <!-- Site wrapper -->
    <div class="wrapper">
   
         
        <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper" style="min-height: 1246.8px;">
    <!-- Content Header (Page header) -->
      
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>Shift Course</h1>
          </div>
         
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <!-- left column -->
    <div class="col-md-3">
    </div>
          <div class="col-md-6">
            <!-- general form elements -->
            <div class="card card-primary">
            
              <!-- /.card-header -->
              <!-- form start -->
                        
                        <!--card header-->
                            <div class="card-header">
                                <h3 class="card-title"><b>Shift Course</b></h3>
                      </div>
          <!-- /.card-header -->
        <div class="card-body">
            <div class="row">
              <div class="col-md-12">
		
                    <div class="form-group">
                        <label> ID</label>
                        <input type="text" class="form-control" id="student_id" placeholder="Enter student id*" required>
                    </div>
                    <div class="form-group">
                        <label>Current Course</label>
                        <input type="text" class="form-control" id="course"  disabled>
                    </div>
                   	  
                  <div class="form-group">
                   <label>Select new course</label>
                  <select class="form-control select2bs4" id="course_select" style="width: 100%;" required>
                    
                  </select>
                    
                </div>  
                  
                <!-- /.form-group -->
              </div>
              <!-- /.col -->
            </div>
            <!-- /.row -->
        </div>
            <!-- /.card-body -->
            <!--card footer-->
            <div class="card-footer">
          
                <button type="submit" class="btn btn-primary" onclick="SwitchCourse()">Submit</button>
		<button type="submit" class="btn btn-default float-right">Cancel</button>
            </div>   
                   
            </div>
            <!-- /.card -->

                     

          </div>
     
        </div>
        <!-- /.row -->
      </div><!-- /.container-fluid -->
    </section>
        </div>
        <!-- /.content-wrapper -->
	
      <!-- Main Footer -->
 
        <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->

    <!-- jQuery -->
    <script src="../../plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="../../dist/js/adminlte.min.js"></script>
    <script src="../../dist/js/demo.js"></script>
    <script>
    var switchcoursekey=null;
    	$(document).ready(function(){
    		$.get("http://localhost:9090/BCPMS/pages/forms/sessionStorage.jsp?getSessionKey=user_session_key",function(data,status){
    			if(data!=="invalid session key")
    				{
    				   switchcoursekey=data;
    		           $.post("http://localhost:9090/BCPMS/pages/forms/switchcourse.jsp",{run:"load"},function(data,status){
    		        	   if(data==="invalid"){
    		        		   alert("Invalid user!!");
    		        	   }
    		        	   else{
    		        		   let data1=JSON.parse(data);
    		        		  // console.log(data1);
    		        		   if(data1.length>0)
    		        			{
    		        			   let sel = $('#course_select')[0];
    		        			   let selectHtml=`<option selected="selected" required>Select*</option>`
  		        			       $(selectHtml).appendTo(sel);
    		        			   data1.forEach(function(object){
    		        				   let course_list=`<option>${object.course_name}</option>`
      		                            $(course_list).appendTo(sel);  
    		        			   })  
    		        			} 
    		        	   }
    		           })   		
    			 }
    		})
    		$("#student_id").keypress(function(event){	
    		if(event.keyCode==13){
    			//console.log("enter pressed");
    			$.post("http://localhost:9090/BCPMS/pages/forms/switchcourse.jsp",{run:"keypress",s_id:$("#student_id").val()},function(data,status){
    				if(data!=="invalid")
    					{
    					//console.log(data);
    						$("#course").val(data);
    					}
    			})
    		}
    	})
    	})
    	
    	function SwitchCourse()
    	{
    		$.post("http://localhost:9090/BCPMS/pages/forms/switchcourse.jsp",{run:"s_switch",selectedCourse:$("#course_select").children("option:selected").val(),s_id:$("#student_id").val()},
    				function(data,status){
    			if(data==="updated")
    				{
    					alert("Student switched from his/her course successfully");
    					$(':text').val("");
    					$(':selct').val("");//Not working
    				}
    			else
    				{
    				alert("There is something wrong");
    				}
    		})
    	}
    
    </script>
</body>
</html>